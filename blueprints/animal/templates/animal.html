{% extends 'base.html' %}

{% block title %}Personal Zoo | {{ animal.name }}{% endblock %}

{% block head %}
<!-- Datatables -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/datatables.min.css') }}">
<script src="{{ url_for('static', filename='js/datatables.min.js') }}"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- custom gender colors -->
<style>
    .female {
        color: {{ settings['color_female'][0] }};
    }
    .male {
        color: {{ settings['color_male'][0] }};
    }
    .ambiguous {
        color: {{ settings['color_other'][0] }};
    }
</style>

{% endblock %}

{% block content %}

{% set image = url_for("uploaded_file", folder='animals', filename=animal.image) %}
<div class="row mb-4 ">
    <div class="col">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center align-middle flex-wrap animal-head">
                    <div class="animal-image"><!---->
                        <img class="show_animal_image object-fit-contain" src="{{ image }}" alt="Image for {{ animal.name }}"  style="border-color: {{ animal.background_color }} !important;">
                    </div>
                    <div class="px-4">
                        <div>
                            <h2 class="d-inline">{{ animal.name }}</h2>
                            <span class="gender text-center ml-3">
                                &nbsp;<i class="fa-solid {% if animal.gender == 'female' %} fa-venus female {% elif animal.gender == 'male' %} fa-mars male {% else %}  fa-transgender ambiguous {% endif %} d-sm-inline-block"></i>
                            </span>
                        </div>
                        <div>{{ animal.morph }}</div>
                        <div class="text-muted">{{ animal.art }} (*{{ animal.birth }})</div>
                    </div>
                    {% if animal.current_weight != "0" %}
                    <div class="px-4 text-center border-start border-danger user-select-none clickable animal_show_weight">
                        <div class="fs-4">{{ animal.current_weight }}</div>
                        <div class="text-muted text-lowercase"> Current Weight </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% if current_user.is_authenticated %}
            <div class="card-footer">
                <div class="btn-list">
                    <button class="btn rounded-right animal_edit_button green_button"><i class="fa-solid fa-pen-to-square"></i></button>
                    <button class="btn rounded-right animal_print_button green_button"><i class="fa-solid fa-print"></i></button>
                    <button class="btn rounded-right animal_qr_button green_button"><i class="fa-solid fa-qrcode"></i></button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="row row-cols-1 row-cols-lg-2 g-4">
    <div class="col">
        <div class="card h-100">
            <div class="card-header">
                <div class="flex-grow"> Feedings </div>
                <div class="btn-list">
                    {% if current_user.is_authenticated %}
                    <button class="btn rounded-right feeding_add_button green_button"><i class="fa-solid fa-plus"></i></button>
                    {% endif %}
                </div>
            </div>
            <div class="card-body feeding_card">
                {% if feedings %}
                <div class="feeding_card_table">
                    <table class="table table-striped m-0">
                        <thead>
                            <th class="w-25">Date</th>
                            <th>Count</th>
                            <th>Type</th>
                            <th>Size</th>
                        </thead>
                        <tbody>
                            {% for feeding in feedings %}
                            <tr data-id="{{ feeding.id }}" class="feeding_edit active_row user-select-none">
                                <td>{{ feeding.date | fix_date }}</td>
                                <td>{{ feeding.count }}</td>
                                <td>{{ feeding.type }}</td>
                                <td>{{ feeding.unit }} {%if feeding.ftunit == "weight" %}{{feeding.detail}}{%endif%}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <p class="mb-0">No feedings found!</p>
                {% endif %}
                {% if animal.feeding_size %}
                    <div class="text-muted mt-2 text-center">{{ animal.feeding_size }}</div>
                {% endif %}
            </div>
            <div class="card-footer card-footer-clickable text-right pr-0 show_all_feedings">
                <div style="text-transform: uppercase;">Show all <i class="fa-solid fa-chevron-right"></i></div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100">
            <div class="card-header">
                <div class="flex-grow"> Events/Actions </div>
                <div class="btn-list">
                    {% if current_user.is_authenticated %}
                    <button class="btn history_add_button green_button"><i class="fa-solid fa-plus"></i></button>
                    {% endif %}
                </div>
            </div>
            <div class="card-body history_card">
                {% if history %}
                <table class="table table-striped m-0">
                    <thead>
                        <th class="w-25">Date</th>
                        <th>Event</th>
                        <th>Details</th>
                    </thead>
                    <tbody>
                        {% for event in history %}
                        <tr data-id="{{ event.id }}" class="history_edit active_row user-select-none">
                            <td>{{ event.date | fix_date }}</td>
                            <td>{{ event.name }}</td>
                            <td>{{ event.text|linebreaksbr|safe }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p class="mb-0">No History found!</p>
                {% endif %}
            </div>
            <div class="card-footer card-footer-clickable text-right pr-0 show_all_history">
                <div style="text-transform: uppercase;">Show all <i class="fa-solid fa-chevron-right"></i></div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100">
            <div class="card-header">
                <div class="flex-grow"> Documents </div>
                <div class="btn-list">
                    {% if current_user.is_authenticated %}
                    <button class="btn document_add_button green_button"><i class="fa-solid fa-plus"></i></button>
                    {% endif %}
                </div>
            </div>
            <div class="card-body document_card">
                {% if documents %}
                <table class="table table-striped m-0">
                    <thead>
                        <th>Name</th>
                        <th width="25%">Download</th>
                    </thead>
                    <tbody>
                        {% for document in documents %}
                        <tr class="user-select-none">
                            <td data-id="{{ document.id }}" class="active_row document_edit">{{ document.name }}</td>
                            <td><a href="{{ url_for('document.download', id=document.id) }}" target="_blank">Download</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p class="mb-0">No Documents found!</p>
                {% endif %}
            </div>
            <div class="card-footer card-footer-clickable text-right pr-0">
                <div style="text-transform: uppercase;">You can only upload pdf and image-files!</div>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card h-100">
            <div class="card-header">
                <div class="flex-grow"> Notes </div>
                <div class="btn-list">
                    <!-- no button -->
                </div>
            </div>
            <div class="card-body">
                {{ animal.notes|linebreaksbr|safe }}
            </div>
            <div class="card-footer text-right pr-0">
                <div style="text-transform: uppercase;">Last updated: {{ animal.updated_date | fix_date }}</div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_details" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <!-- Will be loaded later -->
        </div>
    </div>
</div>

<script type="text/javascript" >
    {% include "animals.js" %}
</script>

{% endblock %}